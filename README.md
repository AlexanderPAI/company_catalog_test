# Тестовое задание: справочник организаций, зданий, деятельности

## ВАЖНО
- В сборке nginx, поэтому API доступно на 80 порту (т.е. порт указывать не нужно)
- api-key при каждом запросе указываться в заголовке запроса `api-key`
- при наполнении БД тестовыми данных (`fake_data.py` см. ниже) - дефолтный api-key `611534f5-718f-46cc-9ab8-4388811ef41c` (прям захардкожен в скрипте)

## Технологический стек
```commandline
"fastapi (>=0.128.0,<0.129.0)",
"uvicorn (>=0.40.0,<0.41.0)",
"pydantic (>=2.12.5,<3.0.0)",
"pydantic-settings (>=2.12.0,<3.0.0)",
"sqlalchemy (>=2.0.46,<3.0.0)",
"alembic (>=1.18.2,<2.0.0)",
"asyncpg (>=0.31.0,<0.32.0)",
"greenlet (>=3.3.1,<4.0.0)"
```

## Первый запуск приложения

### С использованием Makefile

Тестовый `.env`
```dotenv
POSTGRES_USER="postgres"
POSTGRES_PASSWORD="postgres"
POSTGRES_HOST="company_catalog_db"
POSTGRES_PORT=5432
POSTGRES_DB="company_catalog"
# DATABASE_URL требуется исключительно для скрипта наполения БД тестовыми данными
DATABASE_URL="postgresql+asyncpg://postgres:postgres@localhost:5432/company_catalog"
```

1. Создать тестовый `.env`-файл в корневом каталоге приложения

2. Собрать образ:
```commandline
make build
```
3. Запустить приложение
```commandline
make up
```
4. Наполнить БД тестовыми данными
```commandline
# в интерпретаторе должен быть пакет python-dotenv
python fake_data.py
```

### Без Makefile напрямую через docker compose
1. Создать тестовый `.env`-файл в корневом каталоге приложения
2. Собрать образ и запустить контейнеры
```commandline
docker compose up --build -d
```
3. Наполнить БД тестовыми данными
```commandline
# в интерпретаторе должен быть пакет python-dotenv
python fake_data.py
```

Приложение доступно localhost на 80 порту (т.е порт указывать не обязательно)

Swagger UI:
- [http://127.0.0.1/docs]()

Redoc:
- [http://127.0.0.1/redoc]()

## Диаграмма базы данных
![](db_diagram.png)

## Эндпоинты
- `/v1/company/get_by_area` - получить список компаний в радиусе
- `/v1/company/get_by_activity` - получить список компаний по виду деятельности (включая подвиды)
- `/v1/company/get_by_specific_activity` - получить список компаний по виду деятельности (не включая подвиды)
- `/v1/company/get_by_building` - получить список компаний, расположенных по конкретному адресу (по зданию)
- `/v1/company/get_by_id` - получить компанию по ID (UUID)
- `/v1/company/get_by_name` - получить компанию по названию
- `/v1/company/list` - получить список всех компаний (не входит в ТЗ для проверки загрузки тестовых данных)


## ТЗ

Необходимо реализовать REST API приложения для справочника Организаций, Зданий, Деятельности.
1.	**Организация** - Представляет собой карточку организации в справочнике и должна содержать в себе следующую информацию:
- Название: Например ООО “Рога и Копыта”
- Номер телефона: организация может иметь несколько номеров телефонов (2-222-222, 3-333-333, 8-923-666-13-13)
- Здание: Организация должна находится в одном конкретном здании (Например, Блюхера, 32/1)
- Деятельность: Организация может заниматься несколькими видами деятельностей (Например, “Молочная продукция”, “Мясная продукция”)
2.	**Здание** - Содержит в себе как минимум информацию о конкретном здании, а именно:
- Адрес: Например - г. Москва, ул. Ленина 1, офис 3
- Географические координаты: Местоположение здания должно быть в виде широты и долготы.
3.	**Деятельность** - позволяет классифицировать род деятельности организаций в каталоге. Имеет название и может в древовидном виде вкладываться друг в друга. Пример возможного дерева деятельности:
  - Еда
    - Мясная продукция
    - Молочная продукция
  - Автомобили
    - Грузовые
  - Легковые
      - Запчасти
      - Аксессуары
4. Стэк - стэк fastapi+pydantic+sqlalchemy+alembic

#### Функционал приложения.
Взаимодействие с пользователем происходит посредством HTTP запросов к API серверу с использованием статического API ключа. Все ответы должны быть в формате JSON. Необходимо реализовать следующие методы:
- список всех организаций находящихся в конкретном здании
- список всех организаций, которые относятся к указанному виду деятельности
- список организаций, которые находятся в заданном радиусе/прямоугольной области относительно указанной точки на карте. список зданий
- вывод информации об организации по её идентификатору
- искать организации по виду деятельности. Например, поиск по виду деятельности «Еда», которая находится на первом уровне дерева, и чтобы нашлись все организации, которые относятся к видам деятельности, лежащим внутри. Т.е. в результатах поиска должны отобразиться организации с видом деятельности Еда, Мясная продукция, Молочная продукция.
- поиск организации по названию
- ограничить уровень вложенности деятельностей 3 уровням
